name: ğŸš€ Streamlined CI (Qodo-Optimized)

# Optimierte CI Pipeline - Style/Quality Checks werden von Qodo Ã¼bernommen
# Fokus auf Build-kritische und Funktions-Tests

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  NODE_VERSION: '20'

jobs:
  # Nur noch Essential CI Checks - Rest macht Qodo
  essential-checks:
    name: ğŸ”§ Essential Build & Function Checks
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ—ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: |
            package-lock.json

      - name: ğŸ“¦ Install dependencies
        run: npm ci --prefer-offline --no-audit

      # âœ… Build-kritische TypeScript Compilation (bleibt in CI)
      - name: ğŸ” TypeScript Build Check
        run: npm run typecheck

      # âš¡ Unit Tests werden jetzt in Azure Free Tier ausgefÃ¼hrt
      - name: ğŸ“‹ Unit Tests Status
        run: |
          echo "âš¡ Unit Tests werden in Azure Static Web Apps Free Tier ausgefÃ¼hrt"
          echo "ğŸ”— Tests sind Teil der Azure Build Pipeline"
          echo "âœ… Deployment schlÃ¤gt fehl wenn Tests nicht bestehen"

      # âœ… Build Validation (bleibt in CI)
      - name: ğŸ—ï¸ Production Build
        run: npm run build

  # âœ… E2E Tests (bleibt in CI - kann nicht von Qodo gemacht werden)
  e2e-tests:
    name: ğŸ­ E2E Tests
    runs-on: ubuntu-latest
    needs: essential-checks
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ—ï¸ Setup Node.js  
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: |
            package-lock.json

      - name: ğŸ“¦ Install dependencies
        run: npm ci --prefer-offline --no-audit

      # Install Playwright browsers and required OS dependencies on the runner
      - name: ğŸ­ Install Playwright Browsers
        uses: microsoft/playwright-github-action@v1

      - name: ğŸ­ Run Playwright Tests
        run: npm run test:e2e

      - name: ğŸ“Š Upload Playwright Report
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: playwright-report
          path: playwright-report/

  # âœ… Nur noch Error-Level ESLint (Style Rules â†’ Qodo)
  critical-lint:
    name: ğŸš¨ Critical Lint Errors Only
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ—ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ Install dependencies
        run: npm ci --prefer-offline --no-audit

      # Nur Error-Level (Style â†’ Qodo)
      - name: ğŸš¨ ESLint Critical Errors Only
        run: npm run lint -- --quiet --max-warnings=0

  # âŒ ENTFERNTE CHECKS (jetzt Qodo):
  # - Prettier formatting
  # - Markdownlint  
  # - Dependency vulnerability scan
  # - Code style violations (non-error)
  # - Vue/Nuxt best practices
  # - JSDoc documentation quality
  # - TypeScript advanced patterns